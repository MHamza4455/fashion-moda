{% if product.metafields.custom.badge_image %}
  {% for one_badge in product.metafields.custom.badge_image.value %}
    {% assign show_badge = false %}
    {% liquid 


      if type == 'product-card'
        if one_badge.locations_to_display_on.value contains "Collection Page" and template == 'collection'
          assign show_badge = true 
        endif 
        if one_badge.locations_to_display_on.value contains "All Other Product Tiles" and template != 'collection'
          assign show_badge = true 
        endif
        if one_badge.locations_to_display_on.value contains "Search Results Page" and template == 'search'
          assign show_badge = true 
        endif 
      endif


      if type == 'product-page' and one_badge.locations_to_display_on.value contains "Product Page"
        assign show_badge = true 
      endif
    %}
    {% if show_badge %}

      {%- if type == 'product-page' -%}
        {% assign badge_css_selector = ".product-single__media-slide:first-child a" %}
      {%- endif -%}
      {%- if type == 'product-card' -%}
        {% assign badge_css_selector = "#" | append : item_unique | append : " deferred-loading:first-child figure.product__media" %}
      {%- endif -%}  

      <script type="application/json" class='badge-info'>
        {
          "image":"{{one_badge.image | image_url}}",
          "position":"{{one_badge.position}}",
          "css_selector":"{{badge_css_selector}}"
          {% if one_badge.size %}, "size":"{{one_badge.size.value}}"{% endif %}
          {% if one_badge.start_date %},"start_date": "{{one_badge.start_date}}"{% endif %}
          {% if one_badge.end_date %},"end_date": "{{one_badge.end_date}}"{% endif %}
        }
      </script>
    {% endif %}
  {% endfor %}
{% endif %}

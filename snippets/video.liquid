<!-- /snippets/video.liquid -->
{%- liquid
  assign sizes = image_sizes | default: '100vw'
  capture image_classes
    echo 'video-background video-background--image'
    if image == blank
      echo ' placeholder-bg'
    endif
    if background_video != blank
      echo ' display_none'
    endif
  endcapture
-%}

{%- capture image_attributes -%}
  {%- if animations_enabled -%}
    data-aos="fade"
    data-aos-anchor="{{ animation_anchor }}"
    data-aos-delay="{{ animation_delay }}"
  {%- endif -%}
{%- endcapture -%}

<div class="video__container {{text_position_mobile}} video__container--{{ unique }} {{ text_color }}{% if addBlurLayer %} video-background-blur{% endif %}" id="video-{{ unique }}-container">

  {%- render 'image-fill',
    is_background: true,
    img_object: image,
    image_attributes: image_attributes,
    sizes: sizes,
    classes: image_classes,
    placeholder_svg: 'lifestyle-1' -%}

  {%- assign video_bg_show = false -%}
  {%- if background_video != blank or background_video_mobile != blank -%}

    {% if background_video.sources != blank %}
      {%- assign background_video = background_video.sources[1].url -%}
      {%- assign background_video_mobile = background_video_mobile.sources[1].url -%}
    {% endif %}

    {% if background_video.sources == blank and background_video_mobile.sources != blank %}
      {%- assign background_video = background_video_mobile.sources[1].url -%}
      {%- assign background_video_mobile = background_video_mobile.sources[1].url -%}
    {% endif %}

    {%- assign video_link_bg_downcase = background_video | downcase -%}
    {%- assign video_link_bg_downcase_mobile = background_video_mobile | downcase -%}

    {%- if video_link_bg_downcase contains '.mp4' or video_link_bg_downcase_mobile contains '.mp4' -%}
      {%- assign video_bg_show = true -%}

      {%- capture additional_video_button -%}
        <a href="#" class="video-text-link" data-video-bg-play>
          {%- render 'icon-play' -%}
        </a>
      {%- endcapture -%}

      {%- if video_link != blank -%}
        {%- capture additional_video_button -%}
          <a href="#" class="btn {{ button_style }} {{ button_size }} {{ button_color }}" data-video-bg-play>
            {{ 'video.play_bg_video' | t }}
          </a>
        {%- endcapture -%}
      {%- endif -%}
    {%- endif -%}
  {%- endif -%}

  {%- if video_bg_show -%}
    <div class="video-background resize-device-change">
      <div class="video__player is-loading"
        data-video-player
        data-video-id="{{ unique }}-video-background">
        <template data-video-template>
          <video
            id="{{ unique }}-video-background"
            data-video-type="native"
            data-video-autoplay
            playsinline
            autoplay
            loop
            muted

            {% unless maintain_raio and maintain_raio != blank %}
              width="320"
              height="240"
            {% endunless %}

            data-desktop-source = "{{background_video}}"
            data-mobile-source = "{{background_video_mobile}}"
            data-mobile-resolution = 479
            >
            <source  type="video/mp4" />
          </video>

        </template>
      </div>
    </div>
  {%- endif -%}
{% unless limitTextoverlaytoBox %}<div class="overlay video__overlay" style="--overlay-opacity: {{ overlay_opacity }};"></div> {% endunless  %}
</div>

<div class="align--{{ text_position }} {{ text_color }} text-inside {{text_position_mobile}}">
  {% comment %} Text {% endcomment %}
  <div class="video-text-wrapper wrapper--narrow video-content-mobile-vertical-{{section.settings.text_position_vertical_mobile}}{% if show_text_shadow %} backdrop--radial{% endif %}{% if addBlurLayer %} background-blur{% endif %}">
    <div class="video-text-wrapper-inner banner-text-content {{ text_width_class }}">
    {% if limitTextoverlaytoBox %}<div class="overlay video__overlay" style="--overlay-opacity: {{ overlay_opacity }};"></div> {% endif  %}
    {%- if video_link != blank -%}
      {% comment %} Video Play Button {% endcomment %}
      <div class="main-buttons main-buttons--video align--{{ text_position }}">{%- liquid
  assign video_link_downcase = video_link | downcase
  assign video_type = ''
  assign video_id = ''
  assign video_parent_id = 'item-video-' | append: unique

  if video_link contains "vimeo.com"
    assign video_type = "vimeo"
  elsif video_link contains "youtube.com"
    assign video_type = "youtube"
  elsif video_link contains "youtu.be"
    assign video_type = "youtube"
    assign youtubeShortlink = true
  elsif video_link_downcase contains ".mp4"
    assign video_type = "native"
  endif

  assign link_array = video_link | split: '/'
  assign id_with_params = link_array | last

  if video_type == "vimeo" or youtubeShortlink
  comment
    https://vimeo.com/[ID]?foo=bar&baz=boo
    https://youtu.be/[ID]?foo=bar&baz=boo
  endcomment
    assign starts_with_id = id_with_params | split: '?'
    assign video_id = starts_with_id | first
  elsif video_type == "youtube" 
  comment
    https://youtube.com/watch?v=[ID]?foo=bar&baz=boo
  endcomment
    assign first_param = id_with_params | split: '&' | first
    assign watch_then_id = first_param | split: '?'
    assign equals_id = watch_then_id[1]
    assign ends_with_id = equals_id | split: '='
    assign video_id = ends_with_id | last
  endif

  if video_type == 'youtube'
    capture video_link
      echo 'https://www.youtube.com/watch?v=' | append: video_id
    endcapture
  elsif video_type == 'vimeo'
    capture video_link
      echo 'https://vimeo.com/' | append: video_id
    endcapture
  endif
-%}{%- if video_type != '' -%}
          <div class="main-buttons__item"
            {% if animations_enabled %}
              data-aos="fade-up"
              data-aos-anchor="{{ animation_anchor }}"
              data-aos-delay="{{ animation_delay }}"
              {%- assign animation_delay = animation_delay | plus: 150 -%}
            {% endif %}>
            <a href="{{ video_link }}"
              class="video-text-link"
              data-video-play="{% render 'photoswipe-video-html' item_link: video_link, item_link_type: video_type, item_link_id: video_id, item_id: video_parent_id %}">
                {%- render 'icon-play' -%}
            </a>
          </div>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- if video_bg_show -%}
      <div class="main-buttons main-buttons--video main-buttons--video-bg align--{{ text_position }}{% if background_video != blank %} display_none{% endif %}">
        <div class="main-buttons__item"
          {% if animations_enabled %}
            data-aos="fade-up"
            data-aos-anchor="{{ animation_anchor }}"
            data-aos-delay="{{ animation_delay }}"
            {%- assign animation_delay = animation_delay | plus: 150 -%}
          {% endif %}>
          {{- additional_video_button -}}
        </div>
      </div>
    {%- endif -%}

    {%- if title != blank -%}
      <div class="main-heading {{ text_color }}{% if has_text_highlight %} {{ text_highlight_wrapper_class }}{% endif %}"
        {% if animations_enabled %}
          data-aos="fade-up"
          data-aos-anchor="{{ animation_anchor }}"
          data-aos-delay="{{ animation_delay }}"
          {%- assign animation_delay = animation_delay | plus: 150 -%}
        {% endif %}>
        {% render 'title-with-highlights',
          title: title,
          heading_highlight_type: heading_highlight_type,
          has_text_highlight: has_text_highlight %}
      </div>
    {%- endif -%}

    {%- if text != blank -%}
      <div class="main-text h2"
        {% if animations_enabled %}
          data-aos="fade-up"
          data-aos-anchor="{{ animation_anchor }}"
          data-aos-delay="{{ animation_delay }}"
          {%- assign animation_delay = animation_delay | plus: 150 -%}
        {% endif %}>
        {{- text  -}}
      </div>
    {%- endif -%}

    {% comment %} Button {% endcomment %}
    {%- if button_text != blank -%}
      <div class="main-buttons align--{{ text_position }}">
        <div class="main-buttons__item"
          {% if animations_enabled %}
            data-aos="fade-up"
            data-aos-anchor="{{ animation_anchor }}"
            data-aos-delay="{{ animation_delay }}"
          {% endif %}>
          <a class="btn {{ button_style }} {{ button_size }} {{ button_color }}{% if button_full_width_mobile %} btn--full-width-mobile{% endif %}" href="{{ button_link }}">{{ button_text }}</a>
        </div>
      </div>
    {%- endif -%}
    </div>
  </div>
</div>

{%- if show_video_flow_controls or show_video_sound_controls -%}
  {%- render 'video-controls',
    show_video_flow_controls: show_video_flow_controls,
    show_video_sound_controls: show_video_sound_controls,
    use_new_video_icons: use_new_video_icons
  -%}
{%- endif -%}

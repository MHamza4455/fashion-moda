{% if settings.enable_pieeye %}
  <script>
  function feedback() {
    const p = window.Shopify.customerPrivacy;
    console.log(`Tracking ${p.userCanBeTracked() ? "en" : "dis"}abled`);
  }
  window.Shopify.loadFeatures(
    [
      {
        name: "consent-tracking-api",
        version: "0.1",
      },
    ],
    function (error) {
      if (error) throw error;
      if ("pieye-widget" in window)
        window.Shopify.customerPrivacy.setTrackingConsent({
          "analytics": true,
          "marketing": true,
          "preferences": true,
          "sale_of_data": true,
        }, () => console.log("Awaiting consent")
      );
    }
  );

  window.addEventListener("pieEyeShopifyConsent", function (e) {
        console.log('pieeye shopify consent')
        existConsentShopify = setInterval(function () {
          if (window.Shopify.customerPrivacy) {
            clearInterval(existConsentShopify);
            window.Shopify.customerPrivacy.setTrackingConsent({
              "analytics": e.detail.analytics,
              "marketing": e.detail.marketing,
              "preferences": e.detail.preferences,
              "sale_of_data": e.detail.sale_of_data,
            }, () => console.log("Consent captured"))
          }
        }, 100);
  });
  </script>

  {% if settings.pieeyeDsrpID != blank %}   
    <link rel="stylesheet" href="https://pieeyegpc.pii.ai/1/dsrp/{{ settings.pieeyeDsrpID }}/gpc.css"/>
    <script src="https://pieeyegpc.pii.ai/1/dsrp/{{ settings.pieeyeDsrpID }}/gpc.min.js"></script>
  {% endif %}
  
{% endif %}

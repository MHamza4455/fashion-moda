{%- comment -%}
  Section: Collection Round Cards
  Renders up to 8 round cards with an image and title. Each card is a block with:
  - optional manual image (overrides collection image)
  - optional custom title (defaults to collection title)
  - collection picker (determines link + default image/title)
  - custom link override
{%- endcomment -%}

<section class="round-cards" data-section-id="{{ section.id }}">
    <div class="round-cards__container page-width">
      {%- if section.settings.heading != blank -%}
        <h2 class="round-cards__heading">{{ section.settings.heading | escape }}</h2>
      {%- endif -%}
  
      <div class="round-cards__grid">
        {%- for block in section.blocks -%}
          {%- assign collection = block.settings.collection -%}
          {%- assign img = block.settings.image | default: collection.image -%}
          {%- assign title = block.settings.title | default: collection.title -%}
          {%- assign link = block.settings.link | default: collection.url -%}
  
          <a
            {% if link %}href="{{ link }}"{% endif %}
            class="round-cards__item"
            {{ block.shopify_attributes }}
          >
            <span class="round-cards__image-wrapper">
                {%- if img != blank -%}
                  {%- assign escaped_title = title | escape -%}
                  {{ img | image_url: width: 480 | image_tag:
                    loading: 'lazy',
                    sizes: '(max-width: 768px) 96px, 160px',
                    widths: '96,160,240,320,480',
                    alt: escaped_title,
                    class: 'round-cards__image'
                  }}
                {%- else -%}
                  <span class="round-cards__placeholder" aria-hidden="true"></span>
                {%- endif -%}
              </span>
              
            {%- if title != blank -%}
              <span class="round-cards__title">{{ title }}</span>
            {%- endif -%}
          </a>
        {%- endfor -%}
      </div>
    </div>
  
    <style>
        .round-cards {
          margin: {{ section.settings.section_margin_top }} 0 {{ section.settings.section_margin_bottom }};
        }
      
        .round-cards__heading {
          text-align: center;
          margin-bottom: 1rem;
        }
      
        .round-cards__grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax({{ section.settings.image_size }}, 1fr));
          gap: {{ section.settings.gap }};
          justify-content: center;     /* centers the whole grid */
          justify-items: center;       /* centers individual cards */
          align-items: start;
        }
      
        @media (max-width: 990px) {
          .round-cards__grid {
            grid-template-columns: repeat({{ section.settings.cards_per_row_tablet }}, minmax(0, 1fr));
            justify-content: center;
          }
        }
      
        @media (max-width: 640px) {
          .round-cards__grid {
            grid-template-columns: repeat({{ section.settings.cards_per_row_mobile }}, minmax(0, 1fr));
            justify-content: center;
          }
        }
      
        .round-cards__item {
          text-decoration: none;
          display: flex;
          flex-direction: column;
          align-items: center;
        }
      
        .round-cards__image-wrapper {
          width: {{ section.settings.image_size }};
          height: {{ section.settings.image_size }};
          border-radius: 9999px;
          overflow: hidden;
          display: flex;               /* ensures images stay centered */
          justify-content: center;
          align-items: center;
          background: #f5f5f5;
        }
      
        .round-cards__image {
          width: 100%;
          height: 100%;
          object-fit: cover;
          display: block;
        }
      
        .round-cards__placeholder {
          display: block;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.06);
        }
      
        .round-cards__title {
          margin-top: 0.5rem;
          text-align: center;
          text-transform: none;
          font-size: 20px;
          color: inherit;
        }
      </style>      
  </section>
  
  {% schema %}
  {
    "name": "Collection round cards",
    "tag": "section",
    "class": "section",
    "max_blocks": 8,
    "settings": [
      { "type": "text", "id": "heading", "label": "Heading", "default": "Shop by category" },
      { "type": "select", "id": "gap", "label": "Card gap", "default": "16px", "options": [
        {"value":"8px","label":"8px"},
        {"value":"12px","label":"12px"},
        {"value":"16px","label":"16px"},
        {"value":"24px","label":"24px"}
      ]},
      { "type": "select", "id": "image_size", "label": "Image diameter", "default": "160px", "options": [
        {"value":"96px","label":"Small (96px)"},
        {"value":"128px","label":"Medium (128px)"},
        {"value":"160px","label":"Large (160px)"},
        {"value":"192px","label":"XL (192px)"}
      ]},
      { "type": "select", "id": "title_size", "label": "Title size", "default": "14px", "options": [
        {"value":"12px","label":"12px"},
        {"value":"14px","label":"14px"},
        {"value":"16px","label":"16px"}
      ]},
      { "type": "range", "id": "cards_per_row_desktop", "min": 3, "max": 9, "step": 1, "label": "Cards per row (desktop)", "default": 8 },
      { "type": "range", "id": "cards_per_row_tablet", "min": 2, "max": 6, "step": 1, "label": "Cards per row (tablet)", "default": 4 },
      { "type": "range", "id": "cards_per_row_mobile", "min": 2, "max": 5, "step": 1, "label": "Cards per row (mobile)", "default": 3 },
      { "type": "text", "id": "section_margin_top", "label": "Top margin", "default": "2rem" },
      { "type": "text", "id": "section_margin_bottom", "label": "Bottom margin", "default": "2rem" }
    ],
    "blocks": [
      {
        "type": "card",
        "name": "Card",
        "settings": [
          { "type": "collection", "id": "collection", "label": "Collection" },
          { "type": "image_picker", "id": "image", "label": "Image (optional)" },
          { "type": "text", "id": "title", "label": "Title (optional)" },
          { "type": "url", "id": "link", "label": "Link (optional)" }
        ]
      }
    ],
    "presets": [
      { "name": "Collection round cards", "category": "Collection", "blocks": [
        {"type":"card"},{"type":"card"},{"type":"card"},{"type":"card"}
      ] }
    ]
  }
  {% endschema %}
  